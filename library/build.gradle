plugins {
    id 'com.android.library'
    id 'kotlin-android'
    id 'kotlin-android-extensions'
    id 'com.jfrog.artifactory'
    id 'maven-publish'
    id 'kotlin-kapt'
}

apply from: 'https://smart-locker-1251779293.cos.ap-guangzhou.myqcloud.com/develop/gradle/v1.0/ci.gradle'
apply from: 'https://smart-locker-1251779293.cos.ap-guangzhou.myqcloud.com/develop/gradle/v1.0/maven-push.gradle'

//noinspection GroovyMissingReturnStatement
android {
    compileSdkVersion buildConfig.compileSdk

    defaultConfig {
        minSdkVersion buildConfig.minSdk
        targetSdkVersion buildConfig.targetSdk
        versionCode buildConfig.version.code
        versionName buildConfig.version.name
        consumerProguardFiles 'proguard-rules.pro'
        resourcePrefix "mvvm_"

        testInstrumentationRunner "androidx.test.runner.AndroidJUnitRunner"
        testInstrumentationRunnerArguments clearPackageData: 'true'
        testInstrumentationRunnerArgument "size", "small"

        compileOptions {
            kotlinOptions.freeCompilerArgs += ['-module-name', "${artifactory.groupId}.${artifactory.artifactId}"]
        }

        lintOptions {
            // Turns off checks for the issue IDs you specify.
            disable 'TypographyFractions', 'TypographyQuotes'
            // Turns on checks for the issue IDs you specify. These checks are in
            // addition to the default lint checks.
            enable 'RtlHardcoded', 'RtlCompat', 'RtlEnabled'
            // To enable checks for only a subset of issue IDs and ignore all others,
            // list the issue IDs with the 'check' property instead. This property overrides
            // any issue IDs you enable or disable using the properties above.
            check 'NewApi', 'InlinedApi'
            // If set to true, turns off analysis progress reporting by lint.
            quiet true
            // if set to true (default), stops the build if errors are found.
            abortOnError false
            // if true, only report errors.
            ignoreWarnings true
        }
    }

    dataBinding {
        enabled = true
    }

    testOptions {
        execution 'ANDROIDX_TEST_ORCHESTRATOR'
        unitTests {
            includeAndroidResources = true
        }
    }

    sourceSets {
        main.java.srcDirs += 'src/main/kotlin'
        test.java.srcDirs += 'src/test/kotlin'
        androidTest.java.srcDirs += 'src/androidTest/kotlin'
    }

    buildTypes {
        debug {
        }
        release {
            minifyEnabled true
            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'),
                    'proguard-rules.pro'
        }
    }

    compileOptions {
        encoding = "UTF-8"
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    }

    libraryVariants.all { variant ->
        variant.outputs.all { output ->
            def verName = buildConfig.version.name
            outputFileName = artifactory.artifactId + '-' + verName + '.aar'
        }
    }
}

dependencies {
    implementation fileTree(dir: 'libs', include: ['*.jar'])
    kapt deps.androidx.lifecycleCompiler

    testImplementation deps.kotlin.junit
    testImplementation deps.test.mockk
    testImplementation deps.test.robolectric
    testImplementation deps.androidx.test.coreKtx
    testImplementation deps.androidx.test.runner
    testImplementation deps.androidx.test.rules
    testImplementation deps.androidx.test.junitKtx

    androidTestImplementation deps.kotlin.junit
    androidTestImplementation deps.androidx.test.junitKtx
    androidTestImplementation deps.androidx.test.coreKtx
    androidTestImplementation deps.androidx.test.runner
    androidTestImplementation deps.androidx.test.rules

    androidTestUtil deps.androidx.test.orchestrator

    api deps.androidx.appcompat
    api deps.androidx.coreKtx
    api deps.androidx.collectionKtx
    api deps.androidx.fragmentKtx
    api deps.androidx.annotation
    api deps.androidx.lifecycle
    api deps.androidx.navigationUi
    api deps.androidx.navigationFragment

    api deps.rx.rxJava
    api deps.rx.rxKotlin
    api deps.rx.rxAndroid
    api deps.rx.rxBinding
    api deps.rx.rxBindingCore
    api deps.rx.rxBindingAppcompat
    api deps.rx.rxBindingRecyclerview


    api deps.autoDispose
    api deps.autoDisposeArch
}